import { Close as CloseIcon, Search as SearchIcon } from '@mui/icons-material';
import {
    Box,
    Button,
    IconButton,
    InputAdornment,
    Popover,
    TextField,
    Typography,
} from '@mui/material';
import { useCallback, useRef, useState } from 'react';

// Common emojis organized by category
const EMOJI_DATA = {
    'ğŸ™‚': ['ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ¤£', 'ğŸ˜‚', 'ğŸ™‚', 'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤©', 'ğŸ˜˜', 'ğŸ˜—', 'ğŸ˜š', 'ğŸ˜‹', 'ğŸ˜›', 'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ˜', 'ğŸ¤‘', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤”', 'ğŸ¤', 'ğŸ¤¨', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜’', 'ğŸ™„', 'ğŸ˜¬', 'ğŸ¤¥', 'ğŸ˜Œ', 'ğŸ˜”', 'ğŸ˜ª', 'ğŸ¤¤', 'ğŸ˜´', 'ğŸ˜·', 'ğŸ¤’', 'ğŸ¤•', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ¥´', 'ğŸ˜µ', 'ğŸ¤¯', 'ğŸ¤ ', 'ğŸ¥³', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§'],
    'ğŸ‘‹': ['ğŸ‘‹', 'ğŸ¤š', 'ğŸ–ï¸', 'âœ‹', 'ğŸ––', 'ğŸ‘Œ', 'ğŸ¤Œ', 'ğŸ¤', 'âœŒï¸', 'ğŸ¤', 'ğŸ¤Ÿ', 'ğŸ¤˜', 'ğŸ¤™', 'ğŸ‘ˆ', 'ğŸ‘‰', 'ğŸ‘†', 'ğŸ–•', 'ğŸ‘‡', 'â˜ï¸', 'ğŸ‘', 'ğŸ‘', 'âœŠ', 'ğŸ‘Š', 'ğŸ¤›', 'ğŸ¤œ', 'ğŸ‘', 'ğŸ™Œ', 'ğŸ‘', 'ğŸ¤²', 'ğŸ¤', 'ğŸ™', 'âœï¸', 'ğŸ’ª'],
    'ğŸ§’': ['ğŸ‘¶', 'ğŸ‘§', 'ğŸ§’', 'ğŸ‘¦', 'ğŸ‘©', 'ğŸ§‘', 'ğŸ‘¨', 'ğŸ‘©â€ğŸ¦±', 'ğŸ§‘â€ğŸ¦±', 'ğŸ‘¨â€ğŸ¦±', 'ğŸ‘©â€ğŸ¦°', 'ğŸ§‘â€ğŸ¦°', 'ğŸ‘¨â€ğŸ¦°', 'ğŸ‘±â€â™€ï¸', 'ğŸ‘±', 'ğŸ‘±â€â™‚ï¸', 'ğŸ‘©â€ğŸ¦³', 'ğŸ§‘â€ğŸ¦³', 'ğŸ‘¨â€ğŸ¦³', 'ğŸ‘©â€ğŸ¦²', 'ğŸ§‘â€ğŸ¦²', 'ğŸ‘¨â€ğŸ¦²', 'ğŸ§”', 'ğŸ‘µ', 'ğŸ§“', 'ğŸ‘´', 'ğŸ‘²', 'ğŸ‘³â€â™€ï¸', 'ğŸ‘³', 'ğŸ‘³â€â™‚ï¸', 'ğŸ§•', 'ğŸ‘®â€â™€ï¸', 'ğŸ‘®', 'ğŸ‘®â€â™‚ï¸', 'ğŸ‘·â€â™€ï¸', 'ğŸ‘·', 'ğŸ‘·â€â™‚ï¸', 'ğŸ’‚â€â™€ï¸', 'ğŸ’‚', 'ğŸ’‚â€â™‚ï¸', 'ğŸ•µï¸â€â™€ï¸', 'ğŸ•µï¸', 'ğŸ•µï¸â€â™‚ï¸'],
    'ğŸ±': ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ»â€â„ï¸', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ½', 'ğŸ¸', 'ğŸµ', 'ğŸ™ˆ', 'ğŸ™‰', 'ğŸ™Š', 'ğŸ’', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¤', 'ğŸ£', 'ğŸ¥', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸ›', 'ğŸ¦‹', 'ğŸŒ', 'ğŸ', 'ğŸœ', 'ğŸ¦Ÿ', 'ğŸ¦—', 'ğŸ•·ï¸', 'ğŸ¦‚', 'ğŸ¢', 'ğŸ', 'ğŸ¦', 'ğŸ¦–', 'ğŸ¦•', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦€', 'ğŸ¡', 'ğŸ ', 'ğŸŸ', 'ğŸ¬', 'ğŸ³', 'ğŸ‹', 'ğŸ¦ˆ', 'ğŸŠ'],
    'ğŸ': ['ğŸ', 'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ', 'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸ«', 'ğŸˆ', 'ğŸ’', 'ğŸ‘', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ¥', 'ğŸ…', 'ğŸ†', 'ğŸ¥‘', 'ğŸ¥¦', 'ğŸ¥¬', 'ğŸ¥’', 'ğŸŒ¶ï¸', 'ğŸ«‘', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ«’', 'ğŸ§„', 'ğŸ§…', 'ğŸ¥”', 'ğŸ ', 'ğŸ¥', 'ğŸ¥¯', 'ğŸ', 'ğŸ¥–', 'ğŸ¥¨', 'ğŸ§€', 'ğŸ¥š', 'ğŸ³', 'ğŸ§ˆ', 'ğŸ¥', 'ğŸ§‡', 'ğŸ¥“', 'ğŸ¥©', 'ğŸ—', 'ğŸ–', 'ğŸŒ­', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸ«“', 'ğŸ¥ª', 'ğŸ¥™', 'ğŸ§†', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸ«”', 'ğŸ¥—', 'ğŸ¥˜', 'ğŸ«•', 'ğŸ¥«', 'ğŸ'],
    'âš½': ['âš½', 'ğŸ€', 'ğŸˆ', 'âš¾', 'ğŸ¥', 'ğŸ¾', 'ğŸ', 'ğŸ‰', 'ğŸ¥', 'ğŸ±', 'ğŸª€', 'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ‘', 'ğŸ¥', 'ğŸ', 'ğŸªƒ', 'ğŸ¥…', 'â›³', 'ğŸª', 'ğŸ¹', 'ğŸ£', 'ğŸ¤¿', 'ğŸ¥Š', 'ğŸ¥‹', 'ğŸ½', 'ğŸ›¹', 'ğŸ›¼', 'ğŸ›·', 'â›¸ï¸', 'ğŸ¥Œ', 'ğŸ¿', 'â›·ï¸', 'ğŸ‚', 'ğŸª‚', 'ğŸ‹ï¸', 'ğŸ¤¼', 'ğŸ¤¸', 'ğŸ¤º', 'â›¹ï¸', 'ğŸ¤¾', 'ğŸŒï¸', 'ğŸ‡', 'ğŸ§˜', 'ğŸ„', 'ğŸŠ', 'ğŸ¤½', 'ğŸš£', 'ğŸ§—', 'ğŸšµ', 'ğŸš´', 'ğŸª', 'ğŸ­', 'ğŸ¨', 'ğŸ¬', 'ğŸ¤', 'ğŸ§', 'ğŸ¼', 'ğŸ¹', 'ğŸ¥', 'ğŸ·', 'ğŸº', 'ğŸ¸', 'ğŸª•', 'ğŸ»'],
    'ğŸš': ['ğŸš—', 'ğŸš•', 'ğŸš™', 'ğŸšŒ', 'ğŸš', 'ğŸï¸', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸš', 'ğŸ›»', 'ğŸšš', 'ğŸš›', 'ğŸšœ', 'ğŸï¸', 'ğŸ›µ', 'ğŸš²', 'ğŸ›´', 'ğŸš¨', 'ğŸš”', 'ğŸš', 'ğŸš˜', 'ğŸš–', 'ğŸš¡', 'ğŸš ', 'ğŸšŸ', 'ğŸšƒ', 'ğŸš‹', 'ğŸš', 'ğŸš', 'ğŸš„', 'ğŸš…', 'ğŸšˆ', 'ğŸš‚', 'ğŸš†', 'ğŸš‡', 'ğŸšŠ', 'ğŸš‰', 'âœˆï¸', 'ğŸ›«', 'ğŸ›¬', 'ğŸ›©ï¸', 'ğŸ’º', 'ğŸ›°ï¸', 'ğŸš€', 'ğŸ›¸', 'ğŸš', 'ğŸ›¶', 'â›µ', 'ğŸš¤', 'ğŸ›¥ï¸', 'ğŸ›³ï¸', 'â›´ï¸', 'ğŸš¢', 'ğŸ—¼', 'ğŸ°', 'ğŸ¯', 'ğŸŸï¸', 'ğŸ¡', 'ğŸ¢', 'ğŸ '],
    'ğŸ’»': ['âŒš', 'ğŸ“±', 'ğŸ“²', 'ğŸ’»', 'âŒ¨ï¸', 'ğŸ–¥ï¸', 'ğŸ–¨ï¸', 'ğŸ–±ï¸', 'ğŸ–²ï¸', 'ğŸ•¹ï¸', 'ğŸ—œï¸', 'ğŸ’½', 'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ“¼', 'ğŸ“·', 'ğŸ“¸', 'ğŸ“¹', 'ğŸ¥', 'ğŸ“½ï¸', 'ğŸï¸', 'ğŸ“', 'â˜ï¸', 'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ“º', 'ğŸ“»', 'ğŸ™ï¸', 'ğŸšï¸', 'ğŸ›ï¸', 'ğŸ§­', 'â±ï¸', 'â²ï¸', 'â°', 'ğŸ•°ï¸', 'âŒ›', 'â³', 'ğŸ“¡', 'ğŸ”‹', 'ğŸ”Œ', 'ğŸ’¡', 'ğŸ”¦', 'ğŸ•¯ï¸', 'ğŸª”', 'ğŸ§¯', 'ğŸ›¢ï¸', 'ğŸ’¸', 'ğŸ’µ', 'ğŸ’´', 'ğŸ’¶', 'ğŸ’·', 'ğŸª™', 'ğŸ’°', 'ğŸ’³', 'ğŸ’', 'âš–ï¸', 'ğŸªœ', 'ğŸ§°', 'ğŸª›', 'ğŸ”§', 'ğŸ”¨', 'âš’ï¸', 'ğŸ› ï¸', 'â›ï¸', 'ğŸªš', 'ğŸ”©', 'âš™ï¸'],
    'â¤ï¸': ['â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™', 'ğŸ’œ', 'ğŸ–¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ’”', 'â£ï¸', 'ğŸ’•', 'ğŸ’', 'ğŸ’“', 'ğŸ’—', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’Ÿ', 'â˜®ï¸', 'âœï¸', 'â˜ªï¸', 'ğŸ•‰ï¸', 'â˜¸ï¸', 'âœ¡ï¸', 'ğŸ”¯', 'ğŸ•', 'â˜¯ï¸', 'â˜¦ï¸', 'ğŸ›', 'â›', 'â™ˆ', 'â™‰', 'â™Š', 'â™‹', 'â™Œ', 'â™', 'â™', 'â™', 'â™', 'â™‘', 'â™’', 'â™“', 'ğŸ†”', 'âš›ï¸', 'ğŸ‰‘', 'â˜¢ï¸', 'â˜£ï¸', 'ğŸ“´', 'ğŸ“³', 'ğŸˆ¶', 'ğŸˆš', 'ğŸˆ¸', 'ğŸˆº', 'ğŸˆ·ï¸', 'âœ´ï¸', 'ğŸ†š', 'ğŸ’®', 'ğŸ‰', 'ãŠ™ï¸', 'ãŠ—ï¸', 'ğŸˆ´', 'ğŸˆµ', 'ğŸˆ¹', 'ğŸˆ²', 'ğŸ…°ï¸', 'ğŸ…±ï¸', 'ğŸ†', 'ğŸ†‘', 'ğŸ…¾ï¸', 'ğŸ†˜', 'âŒ', 'â­•', 'ğŸ›‘', 'â›”', 'ğŸ“›', 'ğŸš«', 'ğŸ’¯', 'ğŸ’¢', 'â™¨ï¸', 'ğŸš·', 'ğŸš¯', 'ğŸš³', 'ğŸš±', 'ğŸ”', 'ğŸ“µ', 'ğŸš­', 'â—', 'â•', 'â“', 'â”', 'â€¼ï¸', 'â‰ï¸', 'ğŸ”…', 'ğŸ”†', 'ã€½ï¸', 'âš ï¸', 'ğŸš¸', 'ğŸ”±', 'âšœï¸', 'ğŸ”°', 'â™»ï¸', 'âœ…', 'ğŸˆ¯', 'ğŸ’¹', 'â‡ï¸', 'âœ³ï¸', 'â', 'ğŸŒ', 'ğŸ’ ', 'â“‚ï¸', 'ğŸŒ€', 'ğŸ’¤', 'ğŸ§', 'ğŸš¾', 'â™¿', 'ğŸ…¿ï¸', 'ğŸ›—', 'ğŸˆ³', 'ğŸˆ‚ï¸', 'ğŸ›‚', 'ğŸ›ƒ', 'ğŸ›„', 'ğŸ›…', 'ğŸš¹', 'ğŸšº', 'ğŸš¼', 'âš§ï¸', 'ğŸš»', 'ğŸš®', 'ğŸ¦', 'ğŸ“¶', 'ğŸˆ', 'ğŸ”£', 'â„¹ï¸', 'ğŸ”¤', 'ğŸ”¡', 'ğŸ” ', 'ğŸ†–', 'ğŸ†—', 'ğŸ†™', 'ğŸ†’', 'ğŸ†•', 'ğŸ†“', '0ï¸âƒ£', '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£', '4ï¸âƒ£', '5ï¸âƒ£', '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£', '9ï¸âƒ£', 'ğŸ”Ÿ', 'ğŸ”¢', '#ï¸âƒ£', '*ï¸âƒ£', 'âï¸', 'â–¶ï¸', 'â¸ï¸', 'â¯ï¸', 'â¹ï¸', 'âºï¸', 'â­ï¸', 'â®ï¸', 'â©', 'âª', 'â«', 'â¬', 'â—€ï¸', 'ğŸ”¼', 'ğŸ”½', 'â¡ï¸', 'â¬…ï¸', 'â¬†ï¸', 'â¬‡ï¸', 'â†—ï¸', 'â†˜ï¸', 'â†™ï¸', 'â†–ï¸', 'â†•ï¸', 'â†”ï¸', 'â†ªï¸', 'â†©ï¸', 'â¤´ï¸', 'â¤µï¸', 'ğŸ”€', 'ğŸ”', 'ğŸ”‚', 'ğŸ”„', 'ğŸ”ƒ', 'ğŸµ', 'ğŸ¶', 'â•', 'â–', 'â—', 'âœ–ï¸', 'ğŸŸ°', 'â™¾ï¸', 'ğŸ’²', 'ğŸ’±', 'â„¢ï¸', 'Â©ï¸', 'Â®ï¸', 'ã€°ï¸', 'â°', 'â¿', 'ğŸ”š', 'ğŸ”™', 'ğŸ”›', 'ğŸ”', 'ğŸ”œ', 'âœ”ï¸', 'â˜‘ï¸', 'ğŸ”˜', 'ğŸ”´', 'ğŸŸ ', 'ğŸŸ¡', 'ğŸŸ¢', 'ğŸ”µ', 'ğŸŸ£', 'âš«', 'âšª', 'ğŸŸ¤', 'ğŸ”º', 'ğŸ”»', 'ğŸ”¸', 'ğŸ”¹', 'ğŸ”¶', 'ğŸ”·', 'ğŸ”³', 'ğŸ”²', 'â–ªï¸', 'â–«ï¸', 'â—¾', 'â—½', 'â—¼ï¸', 'â—»ï¸', 'ğŸŸ¥', 'ğŸŸ§', 'ğŸŸ¨', 'ğŸŸ©', 'ğŸŸ¦', 'ğŸŸª', 'â¬›', 'â¬œ', 'ğŸŸ«', 'ğŸ”ˆ', 'ğŸ”‡', 'ğŸ”‰', 'ğŸ”Š', 'ğŸ””', 'ğŸ”•', 'ğŸ“£', 'ğŸ“¢', 'ğŸ‘ï¸â€ğŸ—¨ï¸', 'ğŸ’¬', 'ğŸ’­', 'ğŸ—¯ï¸', 'â™ ï¸', 'â™£ï¸', 'â™¥ï¸', 'â™¦ï¸', 'ğŸƒ', 'ğŸ´', 'ğŸ€„', 'ğŸ•', 'ğŸ•‘', 'ğŸ•’', 'ğŸ•“', 'ğŸ•”', 'ğŸ••', 'ğŸ•–', 'ğŸ•—', 'ğŸ•˜', 'ğŸ•™', 'ğŸ•š', 'ğŸ•›', 'ğŸ•œ', 'ğŸ•', 'ğŸ•', 'ğŸ•Ÿ', 'ğŸ• ', 'ğŸ•¡', 'ğŸ•¢', 'ğŸ•£', 'ğŸ•¤', 'ğŸ•¥', 'ğŸ•¦', 'ğŸ•§'],
    'ğŸš©': ['ğŸ³ï¸', 'ğŸ´', 'ğŸ', 'ğŸš©', 'ğŸ³ï¸â€ğŸŒˆ', 'ğŸ³ï¸â€âš§ï¸', 'ğŸ‡ºğŸ‡³', 'ğŸ‡¦ğŸ‡«', 'ğŸ‡¦ğŸ‡±', 'ğŸ‡©ğŸ‡¿', 'ğŸ‡¦ğŸ‡¸', 'ğŸ‡¦ğŸ‡©', 'ğŸ‡¦ğŸ‡´', 'ğŸ‡¦ğŸ‡®', 'ğŸ‡¦ğŸ‡¶', 'ğŸ‡¦ğŸ‡¬', 'ğŸ‡¦ğŸ‡·', 'ğŸ‡¦ğŸ‡²', 'ğŸ‡¦ğŸ‡¼', 'ğŸ‡¦ğŸ‡º', 'ğŸ‡¦ğŸ‡¹', 'ğŸ‡¦ğŸ‡¿', 'ğŸ‡§ğŸ‡¸', 'ğŸ‡§ğŸ‡­', 'ğŸ‡§ğŸ‡©', 'ğŸ‡§ğŸ‡§', 'ğŸ‡§ğŸ‡¾', 'ğŸ‡§ğŸ‡ª', 'ğŸ‡§ğŸ‡¿', 'ğŸ‡§ğŸ‡¯', 'ğŸ‡§ğŸ‡²', 'ğŸ‡§ğŸ‡¹', 'ğŸ‡§ğŸ‡´', 'ğŸ‡§ğŸ‡¦', 'ğŸ‡§ğŸ‡¼', 'ğŸ‡§ğŸ‡·', 'ğŸ‡®ğŸ‡´', 'ğŸ‡»ğŸ‡¬', 'ğŸ‡§ğŸ‡³', 'ğŸ‡§ğŸ‡¬', 'ğŸ‡§ğŸ‡«', 'ğŸ‡§ğŸ‡®', 'ğŸ‡°ğŸ‡­', 'ğŸ‡¨ğŸ‡²', 'ğŸ‡¨ğŸ‡¦', 'ğŸ‡®ğŸ‡¨', 'ğŸ‡¨ğŸ‡»', 'ğŸ‡§ğŸ‡¶', 'ğŸ‡°ğŸ‡¾', 'ğŸ‡¨ğŸ‡«', 'ğŸ‡¹ğŸ‡©', 'ğŸ‡¨ğŸ‡±', 'ğŸ‡¨ğŸ‡³', 'ğŸ‡¨ğŸ‡½', 'ğŸ‡¨ğŸ‡¨', 'ğŸ‡¨ğŸ‡´', 'ğŸ‡°ğŸ‡²', 'ğŸ‡¨ğŸ‡¬', 'ğŸ‡¨ğŸ‡©', 'ğŸ‡¨ğŸ‡°', 'ğŸ‡¨ğŸ‡·', 'ğŸ‡¨ğŸ‡®', 'ğŸ‡­ğŸ‡·', 'ğŸ‡¨ğŸ‡º', 'ğŸ‡¨ğŸ‡¼', 'ğŸ‡¨ğŸ‡¾', 'ğŸ‡¨ğŸ‡¿', 'ğŸ‡©ğŸ‡°', 'ğŸ‡©ğŸ‡¯', 'ğŸ‡©ğŸ‡²', 'ğŸ‡©ğŸ‡´', 'ğŸ‡ªğŸ‡¨', 'ğŸ‡ªğŸ‡¬', 'ğŸ‡¸ğŸ‡»', 'ğŸ‡¬ğŸ‡¶', 'ğŸ‡ªğŸ‡·', 'ğŸ‡ªğŸ‡ª', 'ğŸ‡¸ğŸ‡¿', 'ğŸ‡ªğŸ‡¹', 'ğŸ‡ªğŸ‡º', 'ğŸ‡«ğŸ‡°', 'ğŸ‡«ğŸ‡´', 'ğŸ‡«ğŸ‡¯', 'ğŸ‡«ğŸ‡®', 'ğŸ‡«ğŸ‡·', 'ğŸ‡¬ğŸ‡«', 'ğŸ‡µğŸ‡«', 'ğŸ‡¹ğŸ‡«', 'ğŸ‡¬ğŸ‡¦', 'ğŸ‡¬ğŸ‡²', 'ğŸ‡¬ğŸ‡ª', 'ğŸ‡©ğŸ‡ª', 'ğŸ‡¬ğŸ‡­', 'ğŸ‡¬ğŸ‡®', 'ğŸ‡¬ğŸ‡·', 'ğŸ‡¬ğŸ‡±', 'ğŸ‡¬ğŸ‡©', 'ğŸ‡¬ğŸ‡µ', 'ğŸ‡¬ğŸ‡º', 'ğŸ‡¬ğŸ‡¹', 'ğŸ‡¬ğŸ‡¬', 'ğŸ‡¬ğŸ‡³', 'ğŸ‡¬ğŸ‡¼', 'ğŸ‡¬ğŸ‡¾', 'ğŸ‡­ğŸ‡¹', 'ğŸ‡­ğŸ‡³', 'ğŸ‡­ğŸ‡°', 'ğŸ‡­ğŸ‡º', 'ğŸ‡®ğŸ‡¸', 'ğŸ‡®ğŸ‡³', 'ğŸ‡®ğŸ‡©', 'ğŸ‡®ğŸ‡·', 'ğŸ‡®ğŸ‡¶', 'ğŸ‡®ğŸ‡ª', 'ğŸ‡®ğŸ‡²', 'ğŸ‡®ğŸ‡±', 'ğŸ‡®ğŸ‡¹', 'ğŸ‡¯ğŸ‡²', 'ğŸ‡¯ğŸ‡µ', 'ğŸŒ', 'ğŸ‡¯ğŸ‡ª', 'ğŸ‡¯ğŸ‡´', 'ğŸ‡°ğŸ‡¿', 'ğŸ‡°ğŸ‡ª', 'ğŸ‡°ğŸ‡®', 'ğŸ‡½ğŸ‡°', 'ğŸ‡°ğŸ‡¼', 'ğŸ‡°ğŸ‡¬', 'ğŸ‡±ğŸ‡¦', 'ğŸ‡±ğŸ‡»', 'ğŸ‡±ğŸ‡§', 'ğŸ‡±ğŸ‡¸', 'ğŸ‡±ğŸ‡·', 'ğŸ‡±ğŸ‡¾', 'ğŸ‡±ğŸ‡®', 'ğŸ‡±ğŸ‡¹', 'ğŸ‡±ğŸ‡º', 'ğŸ‡²ğŸ‡´', 'ğŸ‡²ğŸ‡¬', 'ğŸ‡²ğŸ‡¼', 'ğŸ‡²ğŸ‡¾', 'ğŸ‡²ğŸ‡»', 'ğŸ‡²ğŸ‡±', 'ğŸ‡²ğŸ‡¹', 'ğŸ‡²ğŸ‡­', 'ğŸ‡²ğŸ‡¶', 'ğŸ‡²ğŸ‡·', 'ğŸ‡²ğŸ‡º', 'ğŸ‡¾ğŸ‡¹', 'ğŸ‡²ğŸ‡½', 'ğŸ‡«ğŸ‡²', 'ğŸ‡²ğŸ‡©', 'ğŸ‡²ğŸ‡¨', 'ğŸ‡²ğŸ‡³', 'ğŸ‡²ğŸ‡ª', 'ğŸ‡²ğŸ‡¸', 'ğŸ‡²ğŸ‡¦', 'ğŸ‡²ğŸ‡¿', 'ğŸ‡²ğŸ‡²', 'ğŸ‡³ğŸ‡¦', 'ğŸ‡³ğŸ‡·', 'ğŸ‡³ğŸ‡µ', 'ğŸ‡³ğŸ‡±', 'ğŸ‡³ğŸ‡¨', 'ğŸ‡³ğŸ‡¿', 'ğŸ‡³ğŸ‡®', 'ğŸ‡³ğŸ‡ª', 'ğŸ‡³ğŸ‡¬', 'ğŸ‡³ğŸ‡º', 'ğŸ‡³ğŸ‡«', 'ğŸ‡°ğŸ‡µ', 'ğŸ‡²ğŸ‡°', 'ğŸ‡²ğŸ‡µ', 'ğŸ‡³ğŸ‡´', 'ğŸ‡´ğŸ‡²', 'ğŸ‡µğŸ‡°', 'ğŸ‡µğŸ‡¼', 'ğŸ‡µğŸ‡¸', 'ğŸ‡µğŸ‡¦', 'ğŸ‡µğŸ‡¬', 'ğŸ‡µğŸ‡¾', 'ğŸ‡µğŸ‡ª', 'ğŸ‡µğŸ‡­', 'ğŸ‡µğŸ‡³', 'ğŸ‡µğŸ‡±', 'ğŸ‡µğŸ‡¹', 'ğŸ‡µğŸ‡·', 'ğŸ‡¶ğŸ‡¦', 'ğŸ‡·ğŸ‡ª', 'ğŸ‡·ğŸ‡´', 'ğŸ‡·ğŸ‡º', 'ğŸ‡·ğŸ‡¼', 'ğŸ‡¼ğŸ‡¸', 'ğŸ‡¸ğŸ‡²', 'ğŸ‡¸ğŸ‡¹', 'ğŸ‡¸ğŸ‡¦', 'ğŸ‡¸ğŸ‡³', 'ğŸ‡·ğŸ‡¸', 'ğŸ‡¸ğŸ‡¨', 'ğŸ‡¸ğŸ‡±', 'ğŸ‡¸ğŸ‡¬', 'ğŸ‡¸ğŸ‡½', 'ğŸ‡¸ğŸ‡°', 'ğŸ‡¸ğŸ‡®', 'ğŸ‡¬ğŸ‡¸', 'ğŸ‡¸ğŸ‡§', 'ğŸ‡¸ğŸ‡´', 'ğŸ‡¿ğŸ‡¦', 'ğŸ‡°ğŸ‡·', 'ğŸ‡¸ğŸ‡¸', 'ğŸ‡ªğŸ‡¸', 'ğŸ‡±ğŸ‡°', 'ğŸ‡§ğŸ‡±', 'ğŸ‡¸ğŸ‡­', 'ğŸ‡°ğŸ‡³', 'ğŸ‡±ğŸ‡¨', 'ğŸ‡µğŸ‡²', 'ğŸ‡»ğŸ‡¨', 'ğŸ‡¸ğŸ‡©', 'ğŸ‡¸ğŸ‡·', 'ğŸ‡¸ğŸ‡ª', 'ğŸ‡¨ğŸ‡­', 'ğŸ‡¸ğŸ‡¾', 'ğŸ‡¹ğŸ‡¼', 'ğŸ‡¹ğŸ‡¯', 'ğŸ‡¹ğŸ‡¿', 'ğŸ‡¹ğŸ‡­', 'ğŸ‡¹ğŸ‡±', 'ğŸ‡¹ğŸ‡¬', 'ğŸ‡¹ğŸ‡°', 'ğŸ‡¹ğŸ‡´', 'ğŸ‡¹ğŸ‡¹', 'ğŸ‡¹ğŸ‡³', 'ğŸ‡¹ğŸ‡·', 'ğŸ‡¹ğŸ‡²', 'ğŸ‡¹ğŸ‡¨', 'ğŸ‡¹ğŸ‡»', 'ğŸ‡»ğŸ‡®', 'ğŸ‡ºğŸ‡¬', 'ğŸ‡ºğŸ‡¦', 'ğŸ‡¦ğŸ‡ª', 'ğŸ‡¬ğŸ‡§', 'ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿', 'ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿', 'ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿', 'ğŸ‡ºğŸ‡¸', 'ğŸ‡ºğŸ‡¾', 'ğŸ‡ºğŸ‡¿', 'ğŸ‡»ğŸ‡º', 'ğŸ‡»ğŸ‡¦', 'ğŸ‡»ğŸ‡ª', 'ğŸ‡»ğŸ‡³', 'ğŸ‡¼ğŸ‡«', 'ğŸ‡ªğŸ‡­', 'ğŸ‡¾ğŸ‡ª', 'ğŸ‡¿ğŸ‡²', 'ğŸ‡¿ğŸ‡¼'],
};

// Frequently used emojis for quick access
const FREQUENT_EMOJIS = ['ğŸ˜€', 'ğŸ˜‚', 'â¤ï¸', 'ğŸ‘', 'ğŸ‰', 'ğŸ”¥', 'âœ¨', 'ğŸ’¯', 'ğŸ®', 'ğŸ­', 'ğŸª', 'ğŸ¨', 'ğŸ¬', 'ğŸ¤', 'ğŸ§', 'ğŸµ', 'ğŸ†', 'â­', 'ğŸ’¡', 'ğŸ“', 'ğŸ””', 'âš¡', 'ğŸ’ª', 'ğŸ™Œ', 'ğŸ‘‹', 'ğŸ¤”', 'ğŸ˜', 'ğŸ¥³', 'ğŸ˜', 'ğŸ¤©'];

interface EmojiPickerProps {
    value: string;
    onChange: (emoji: string) => void;
}

export default function EmojiPicker({ value, onChange }: EmojiPickerProps) {
    const [anchorEl, setAnchorEl] = useState<HTMLElement | null>(null);
    const [search, setSearch] = useState('');
    const [selectedCategory, setSelectedCategory] = useState<string>('ğŸ•');
    const [focusedIndex, setFocusedIndex] = useState<number>(-1);
    const gridRef = useRef<HTMLDivElement>(null);

    const handleOpen = (event: React.MouseEvent<HTMLElement>) => {
        setAnchorEl(event.currentTarget);
        setFocusedIndex(-1);
    };

    const handleClose = () => {
        setAnchorEl(null);
        setSearch('');
        setFocusedIndex(-1);
    };

    const handleSelect = useCallback((emoji: string) => {
        onChange(emoji);
        setAnchorEl(null);
        setSearch('');
        setFocusedIndex(-1);
    }, [onChange]);

    const open = Boolean(anchorEl);

    // Filter emojis based on search
    const getFilteredEmojis = useCallback(() => {
        if (search) {
            const allEmojis = Object.values(EMOJI_DATA).flat();
            // Simple search - just return all emojis that include the search term in their category
            // or match the emoji itself
            return allEmojis.filter((emoji) => emoji.includes(search));
        }
        if (selectedCategory === 'ğŸ•') {
            return FREQUENT_EMOJIS;
        }
        return EMOJI_DATA[selectedCategory as keyof typeof EMOJI_DATA] || [];
    }, [search, selectedCategory]);

    const categories = ['ğŸ•', ...Object.keys(EMOJI_DATA)];
    const filteredEmojis = getFilteredEmojis();

    // Handle keyboard navigation in emoji grid
    const handleKeyDown = useCallback((event: React.KeyboardEvent) => {
        const emojisPerRow = 8;
        const currentEmojis = getFilteredEmojis();
        const maxIndex = Math.min(currentEmojis.length - 1, 199);

        switch (event.key) {
            case 'ArrowRight':
                event.preventDefault();
                setFocusedIndex((prev) => Math.min(prev + 1, maxIndex));
                break;
            case 'ArrowLeft':
                event.preventDefault();
                setFocusedIndex((prev) => Math.max(prev - 1, 0));
                break;
            case 'ArrowDown':
                event.preventDefault();
                setFocusedIndex((prev) => Math.min(prev + emojisPerRow, maxIndex));
                break;
            case 'ArrowUp':
                event.preventDefault();
                setFocusedIndex((prev) => Math.max(prev - emojisPerRow, 0));
                break;
            case 'Enter':
            case ' ':
                event.preventDefault();
                if (focusedIndex >= 0 && focusedIndex <= maxIndex) {
                    handleSelect(currentEmojis[focusedIndex]);
                }
                break;
            case 'Escape':
                handleClose();
                break;
        }
    }, [getFilteredEmojis, focusedIndex, handleSelect]);

    // Category names for accessibility
    const categoryNames: Record<string, string> = {
        'ğŸ•': 'Frequently used',
        'ğŸ™‚': 'Smileys & Emotion',
        'ğŸ‘‹': 'People & Body',
        'ğŸ§’': 'People',
        'ğŸ±': 'Animals & Nature',
        'ğŸ': 'Food & Drink',
        'âš½': 'Activities',
        'ğŸš': 'Travel & Places',
        'ğŸ’»': 'Objects',
        'â¤ï¸': 'Symbols',
        'ğŸš©': 'Flags',
    };

    return (
        <>
            <Button
                variant="outlined"
                onClick={handleOpen}
                aria-label={`Select emoji. Current: ${value || 'none'}`}
                aria-haspopup="dialog"
                aria-expanded={open}
                sx={{
                    minWidth: 50,
                    height: 40,
                    fontSize: '1.5rem',
                    borderColor: 'divider',
                }}
            >
                {value || 'ğŸ“'}
            </Button>

            <Popover
                open={open}
                anchorEl={anchorEl}
                onClose={handleClose}
                anchorOrigin={{
                    vertical: 'bottom',
                    horizontal: 'left',
                }}
                transformOrigin={{
                    vertical: 'top',
                    horizontal: 'left',
                }}
                slotProps={{
                    paper: {
                        role: 'dialog',
                        'aria-label': 'Emoji picker',
                    },
                }}
            >
                <Box sx={{ width: 352, p: 1.5, overflow: 'hidden' }}>
                    {/* Search */}
                    <TextField
                        fullWidth
                        size="small"
                        placeholder="Search emojis..."
                        value={search}
                        onChange={(e) => setSearch(e.target.value)}
                        sx={{ mb: 1.5 }}
                        aria-label="Search emojis"
                        inputProps={{
                            'aria-describedby': 'emoji-search-hint',
                        }}
                        InputProps={{
                            startAdornment: (
                                <InputAdornment position="start">
                                    <SearchIcon fontSize="small" aria-hidden="true" />
                                </InputAdornment>
                            ),
                            endAdornment: search && (
                                <InputAdornment position="end">
                                    <IconButton
                                        size="small"
                                        onClick={() => setSearch('')}
                                        aria-label="Clear search"
                                    >
                                        <CloseIcon fontSize="small" />
                                    </IconButton>
                                </InputAdornment>
                            ),
                        }}
                    />
                    <span id="emoji-search-hint" className="visually-hidden" style={{ position: 'absolute', width: 1, height: 1, overflow: 'hidden' }}>
                        Type to search for emojis
                    </span>

                    {/* Category tabs */}
                    {!search && (
                        <Box
                            sx={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(11, 1fr)',
                                gap: 0.25,
                                pb: 1,
                                mb: 1,
                                borderBottom: '1px solid',
                                borderColor: 'divider',
                            }}
                            role="tablist"
                            aria-label="Emoji categories"
                        >
                            {categories.map((category) => (
                                <Box
                                    key={category}
                                    onClick={() => setSelectedCategory(category)}
                                    onKeyDown={(e) => {
                                        if (e.key === 'Enter' || e.key === ' ') {
                                            e.preventDefault();
                                            setSelectedCategory(category);
                                        }
                                    }}
                                    role="tab"
                                    tabIndex={selectedCategory === category ? 0 : -1}
                                    aria-selected={selectedCategory === category}
                                    aria-label={categoryNames[category] || category}
                                    sx={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontSize: '1.25rem',
                                        cursor: 'pointer',
                                        width: 28,
                                        height: 28,
                                        borderRadius: '50%',
                                        bgcolor: selectedCategory === category ? 'primary.main' : 'transparent',
                                        '&:hover': {
                                            bgcolor: selectedCategory === category ? 'primary.main' : 'action.hover',
                                        },
                                        '&:focus': {
                                            outline: '2px solid',
                                            outlineColor: 'primary.main',
                                            outlineOffset: 2,
                                        },
                                    }}
                                >
                                    {category}
                                </Box>
                            ))}
                        </Box>
                    )}

                    {/* Emoji grid */}
                    <Box
                        ref={gridRef}
                        onKeyDown={handleKeyDown}
                        role="grid"
                        aria-label={`${categoryNames[selectedCategory] || 'Emoji'} grid`}
                        tabIndex={0}
                        sx={{
                            display: 'grid',
                            gridTemplateColumns: 'repeat(8, 1fr)',
                            gap: 0.25,
                            maxHeight: 250,
                            overflowY: 'auto',
                            overflowX: 'hidden',
                            '&::-webkit-scrollbar': { width: 6 },
                            '&::-webkit-scrollbar-thumb': { bgcolor: 'divider', borderRadius: 3 },
                            '&:focus': {
                                outline: '2px solid',
                                outlineColor: 'primary.main',
                                outlineOffset: -2,
                            },
                        }}
                    >
                        {filteredEmojis.slice(0, 200).map((emoji, index) => (
                            <Box
                                key={`${emoji}-${index}`}
                                onClick={() => handleSelect(emoji)}
                                onKeyDown={(e) => {
                                    if (e.key === 'Enter' || e.key === ' ') {
                                        e.preventDefault();
                                        handleSelect(emoji);
                                    }
                                }}
                                role="gridcell"
                                tabIndex={focusedIndex === index ? 0 : -1}
                                aria-label={`Select ${emoji}`}
                                sx={{
                                    width: 40,
                                    height: 40,
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontSize: '1.5rem',
                                    cursor: 'pointer',
                                    borderRadius: 1,
                                    userSelect: 'none',
                                    fontFamily: '"Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif',
                                    bgcolor: focusedIndex === index ? 'action.selected' : 'transparent',
                                    '&:hover': {
                                        bgcolor: 'action.hover',
                                    },
                                    '&:focus': {
                                        outline: '2px solid',
                                        outlineColor: 'primary.main',
                                        outlineOffset: -2,
                                    },
                                }}
                            >
                                {emoji}
                            </Box>
                        ))}
                    </Box>

                    {filteredEmojis.length === 0 && (
                        <Typography color="text.secondary" textAlign="center" py={2}>
                            No emojis found
                        </Typography>
                    )}
                </Box>
            </Popover>
        </>
    );
}
